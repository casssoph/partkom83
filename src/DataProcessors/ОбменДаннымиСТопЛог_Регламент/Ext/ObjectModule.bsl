
//#Если Сервер тогда
	
	Перем мАдресВебСервиса;
	
	Процедура ВыполнитьРегламентноеЗадание() Экспорт
		
		//Если НЕ ОбщегоНазначения.ЭтоРабочаяИнформационнаяБаза() тогда
			//ВызватьИсключение "Данная операция выполняется только в рабочей информационной базе.";		
		//КонецЕсли;
		
		Если НЕ ЗначениеЗаполнено(ИдентификаторУзлаОбмена) тогда
			ВызватьИсключение "Не заполнен реквизит ""Узел обмена"".";		
		КонецЕсли;
		
		//Семенов И.П. 06.02.2019 XX-1768(
		Попытка
		//)Семенов И.П.
			лМетаданныеПланаОбмена = Метаданные.ПланыОбмена.ОбменПартКом83_TopLog;
			лМенеджерПланаОбмена = ОбщегоНазначения.МенеджерОбъектаПоМетаданным(лМетаданныеПланаОбмена);
			
			лПолучатель = лМенеджерПланаОбмена.ЭтотУзел();
			лКодПолучателя = Число(лПолучатель.ИдентификаторУзла);
			
			лОтправитель = ОбменДаннымиКлиентСервер.ПолучитьВходящийУзелОбмена(лМетаданныеПланаОбмена, ИдентификаторУзлаОбмена);
			лКодОтправителя = лОтправитель.ИдентификаторУзла;
			лНомерПринятого = ОбщегоНазначения.ЗначениеРеквизитаОбъекта(лОтправитель, "НомерПринятого");
			
			
			лОпределения = Новый WSОпределения(мАдресВебСервиса);
			лПрокси = Новый WSПрокси(лОпределения, лОпределения.Сервисы[0].URIПространстваИмен,
			лОпределения.Сервисы[0].Имя, лОпределения.Сервисы[0].ТочкиПодключения[0].Имя);
			
			лОтветСервера = лПрокси.GetExchangeMessage(лМетаданныеПланаОбмена.Имя, лКодПолучателя, лНомерПринятого);
			
			лСообщениеОбмена = лОтветСервера;
			ТекстСообщения = лОтветСервера;
			
			// без этого на сервере не работает почему то
			лТекстовыйДокумент = Новый ТекстовыйДокумент;
			лТекстовыйДокумент.УстановитьТекст(лСообщениеОбмена);
			лСообщениеОбмена = лТекстовыйДокумент.ПолучитьТекст();
		//Семенов И.П. 06.02.2019 XX-1768(
		Исключение
		    ТекстОшибки = ОписаниеОшибки();
		   	ОбменДаннымиКлиентСервер.ЗафиксироватьСообщениеВИсторииОбмена(0,ПланыОбмена.ОбменПартКом83_TopLog.ПустаяСсылка(),"",,Истина,ТекстОшибки);
			ВызватьИсключение ТекстОшибки;
		КонецПопытки;
		//)Семенов И.П.
		лМенеджерПланаОбмена.ЗагрузитьСообщениеОбмена(лСообщениеОбмена);
		лУпаковщик = Неопределено;
		
	КонецПроцедуры
	Если ОбщегоНазначения.ЭтоРабочаяИнформационнаяБаза() Тогда 
		мАдресВебСервиса = Справочники.НастройкиРеквизитовДляОбменов.Обмен_1С_ТопЛог.СтрокаДляРабочейБазы;
	Иначе
		мАдресВебСервиса = Справочники.НастройкиРеквизитовДляОбменов.Обмен_1С_ТопЛог.СтрокаДляТестовойБазы;
	КонецЕсли;
	
//#КонецЕсли