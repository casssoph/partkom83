#Область РаботаСоСтрокамиЗаявок
Функция СтрокаЗаявкиЗакрыта(СтрокаЗаявки,Отказ = ложь) Экспорт
	
	ЗаявкаЗакрыта = СтрокаЗаявки.СостояниеЗаявки = Справочники.СтатусыДокументов.ЗаявкаПокупателяЗакрыт;
	Отказ = ЗаявкаЗакрыта;
	 Возврат  ЗаявкаЗакрыта;
	
КонецФункции	

Функция ЗаказЗакрыт(ДокументСсылка) Экспорт
ЗапросЗакрытых  = новый Запрос("ВЫБРАТЬ
                               |	ЗаказПоставщикуТовары.СтрокаЗаявки
                               |ПОМЕСТИТЬ ВТСтрокиДокумента
                               |ИЗ
                               |	Документ.ЗаказПоставщику.Товары КАК ЗаказПоставщикуТовары
                               |ГДЕ
                               |	ЗаказПоставщикуТовары.Ссылка = &ДокументСсылка
                               |
                               |ОБЪЕДИНИТЬ ВСЕ
                               |
                               |ВЫБРАТЬ
                               |	КорректировкаЗаказаПоставщикуТовары.СтрокаЗаявки
                               |ИЗ
                               |	Документ.КорректировкаЗаказаПоставщику.Товары КАК КорректировкаЗаказаПоставщикуТовары
                               |ГДЕ
                               |	КорректировкаЗаказаПоставщикуТовары.Ссылка = &ДокументСсылка
                               |;
                               |
                               |////////////////////////////////////////////////////////////////////////////////
                               |ВЫБРАТЬ РАЗЛИЧНЫЕ
                               |	МАКСИМУМ(ЗаказыПоставщикамОстатки.СтрокаЗаявки) КАК СтрокаЗаявки
                               |ИЗ
                               |	ВТСтрокиДокумента КАК ВТСтрокиДокумента
                               |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ЗаказыПоставщикам.Остатки КАК ЗаказыПоставщикамОстатки
                               |		ПО ВТСтрокиДокумента.СтрокаЗаявки = ЗаказыПоставщикамОстатки.СтрокаЗаявки
                               |			И (ЗаказыПоставщикамОстатки.КоличествоОстаток > 0)
                               |
                               |ИМЕЮЩИЕ
                               |	МАКСИМУМ(ЗаказыПоставщикамОстатки.СтрокаЗаявки) ЕСТЬ NULL")	;
ЗапросЗакрытых.УстановитьПараметр("ДокументСсылка",ДокументСсылка);
Результат  = ЗапросЗакрытых.Выполнить();

Возврат не Результат.Пустой();
Конецфункции	

Процедура ПроверитьНаЗакрытыеСтроки(ТЧТоваров,Отказ = ложь,ТипПоставкиПроверки = Неопределено) Экспорт
	ЗапросЗакрытых = новый Запрос;
	ТекстЗапроса = "ВЫБРАТЬ 
	|	ИдентификаторыСтрокЗаявок.Ссылка как СтрокаЗаявки
	|ИЗ
	|	Справочник.ИдентификаторыСтрокЗаявок КАК ИдентификаторыСтрокЗаявок
	|ГДЕ
	|	ИдентификаторыСтрокЗаявок.СостояниеЗаявки = ЗНАЧЕНИЕ(Справочник.СтатусыДокументов.ЗаявкаПокупателяЗакрыт)
	|	И ИдентификаторыСтрокЗаявок.Ссылка В(&МассивСтрокЗаявок)
	| %1 ";
	ЗапросЗакрытых.Текст = СтрШаблон(ТекстЗапроса,?(ТипПоставкиПроверки = Неопределено,"","И ИдентификаторыСтрокЗаявок.ТипПоставки = &ТипПоставки "));
	ЗапросЗакрытых.УстановитьПараметр("МассивСтрокЗаявок",ТЧТоваров.выгрузитьКолонку("СтрокаЗаявки"));
	ЗапросЗакрытых.УстановитьПараметр("ТипПоставки",ТипПоставкиПроверки);	
	
	Результат = ЗапросЗакрытых.Выполнить();
	
	Если не Результат.Пустой() тогда 
		МассивЗакрытыхСтрок = результат.Выгрузить().ВыгрузитьКолонку("СтрокаЗаявки");
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю("В документе присутствуют закрытые строки ( "+СтрСоединить(МассивЗакрытыхСтрок)+" ), распроведение запрещено",,,,отказ);
	КонецЕсли;	
	
	
КонецПроцедуры	
	
	
#КонецОбласти
